<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EHR Study Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 600px;
            min-height: 80vh;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="container bg-white p-8 rounded-xl shadow-lg flex flex-col items-center">
        <h1 id="quiz-title" class="text-3xl font-bold text-gray-800 mb-6 text-center">EHR Study Quiz</h1>
        <div id="quiz-container" class="w-full">
            <!-- Loading message, hidden by default -->
            <div id="loading-message" class="text-center text-gray-500 font-medium hidden">
                <p>Loading new questions...</p>
            </div>

            <div id="question-card" class="bg-blue-50 p-6 rounded-lg shadow-inner mb-6 hidden">
                <p id="question-text" class="text-lg text-gray-700 font-medium mb-4">Question loading...</p>
                <div id="options-container" class="space-y-3">
                    <!-- Options will be dynamically generated here -->
                </div>
            </div>
            <div id="results-container" class="text-center hidden">
                <p id="score-text" class="text-2xl font-semibold mb-4 text-gray-700">Quiz complete!</p>
                <button id="restart-button" class="px-6 py-3 bg-blue-600 text-white font-medium rounded-full shadow-md hover:bg-blue-700 transition-colors">Restart Quiz</button>
            </div>
            <div id="message-box" class="mt-4 p-3 text-center text-sm font-medium rounded-lg hidden"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let questions = [];
            let currentQuestionIndex = 0;
            let score = 0;

            const quizContainer = document.getElementById('quiz-container');
            const questionCard = document.getElementById('question-card');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const resultsContainer = document.getElementById('results-container');
            const scoreText = document.getElementById('score-text');
            const restartButton = document.getElementById('restart-button');
            const messageBox = document.getElementById('message-box');
            const loadingMessage = document.getElementById('loading-message');

            // Simple function to shuffle an array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Function to show a temporary message
            function showMessage(text, isCorrect) {
                messageBox.textContent = text;
                messageBox.classList.remove('hidden', 'bg-red-200', 'text-red-800', 'bg-green-200', 'text-green-800');
                if (isCorrect) {
                    messageBox.classList.add('bg-green-200', 'text-green-800');
                } else {
                    messageBox.classList.add('bg-red-200', 'text-red-800');
                }
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 1500); // Hide after 1.5 seconds
            }

            // Function to load the current question
            function loadQuestion() {
                const q = questions[currentQuestionIndex];
                // Decode HTML entities (e.g., &quot;) from the API response
                const parser = new DOMParser();
                questionText.textContent = parser.parseFromString(`<!doctype html><body>${q.question}`, 'text/html').body.textContent;
                optionsContainer.innerHTML = ''; // Clear previous options

                q.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = parser.parseFromString(`<!doctype html><body>${option}`, 'text/html').body.textContent;
                    button.classList.add('w-full', 'px-4', 'py-3', 'text-left', 'bg-gray-100', 'text-gray-800', 'rounded-lg', 'font-medium', 'hover:bg-gray-200', 'transition-colors', 'shadow-sm');
                    button.onclick = () => checkAnswer(option, q.answer);
                    optionsContainer.appendChild(button);
                });
            }

            // Function to check the user's answer
            function checkAnswer(selectedOption, correctAnswer) {
                if (selectedOption === correctAnswer) {
                    score++;
                    showMessage("Correct!", true);
                } else {
                    showMessage(`Incorrect. The answer was: ${correctAnswer}`, false);
                }

                currentQuestionIndex++;
                if (currentQuestionIndex < questions.length) {
                    setTimeout(loadQuestion, 1600);
                } else {
                    showResults();
                }
            }

            // Function to show final quiz results
            function showResults() {
                questionCard.classList.add('hidden');
                resultsContainer.classList.remove('hidden');
                scoreText.textContent = `You scored ${score} out of ${questions.length}!`;
            }

            // Function to start or restart the quiz by fetching new questions
            async function fetchQuestions() {
                // Show a loading message and hide the question card
                questionCard.classList.add('hidden');
                resultsContainer.classList.add('hidden');
                loadingMessage.classList.remove('hidden');

                currentQuestionIndex = 0;
                score = 0;

                try {
                    // Fetch 10 random general knowledge questions
                    const response = await fetch('https://opentdb.com/api.php?amount=10&type=multiple');
                    const data = await response.json();

                    if (data.response_code === 0) {
                        questions = data.results.map(item => {
                            // Combine correct and incorrect answers and shuffle them
                            const options = shuffleArray([...item.incorrect_answers, item.correct_answer]);
                            return {
                                question: item.question,
                                options: options,
                                answer: item.correct_answer
                            };
                        });
                        loadingMessage.classList.add('hidden');
                        questionCard.classList.remove('hidden');
                        loadQuestion();
                    } else {
                        throw new Error('API returned an error code.');
                    }
                } catch (error) {
                    loadingMessage.textContent = 'Failed to load questions. Please try again later.';
                    console.error('Error fetching quiz data:', error);
                }
            }

            restartButton.addEventListener('click', fetchQuestions);
            fetchQuestions(); // Initial load of questions
        });
    </script>
</body>
</html>
